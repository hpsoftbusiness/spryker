{% extends molecule('product-item', '@SprykerShop:ShopUi') %}
{% import molecule('product-item') as macros %}

{% define data = {
    cashback: data.product.cashbackAmount | default(null),
    benefitAmount: data.product.benefitAmount | default(null),
    benefitSalesPrice: data.product.benefitSalesPrice | default(null),
    shoppingPointsAmount: data.product.shoppingPointsAmount | default(null),
    shoppingPoints: data.product.shoppingPoints | default(null),
    isAffiliate: data.product.is_affiliate ?? data.product.isAffiliate,
    affiliateData: data.product.affiliate_data ?? data.product.affiliateData,
} %}

{% block extraClass %}
    {{ config.jsName }}
{% endblock %}

{% block body %}
{#    {{ data.product.cashback_amount }}#}
    {% set cashback = data.cashback %}
    {% set benefitAmount = data.benefitAmount %}
    {% set benefitVoucherPrice = data.benefitSalesPrice %}
    {% set shoppoingPointsAmount = data.shoppingPointsAmount %}
    {% set shoppingPointsBenefitPrice =  data.product.prices.SP_BENEFIT ?? null %}

    <ul>
        <li>benefitVoucherPrice: {{ benefitVoucherPrice }}</li>
        <li>benefitAmount: {{ benefitAmount }}</li>
        <li>shoppingPointsBenefitPrice: {{ shoppingPointsBenefitPrice }}</li>
        <li>shoppoingPointsAmount: {{ shoppoingPointsAmount }}</li>
    </ul>

    <div class="{{ config.name }}__container">
        <div class="{{ config.name }}__image-wrap">
            {% block imageContainer %}
                {{ parent() }}
            {% endblock %}

        </div>

        {% if data.idProductAbstract %}
            {% block productAbstractLabels %}
                {% widget 'ProductAbstractLabelWidget' args [data.idProductAbstract] with {
                    data: {
                        parentJsName: config.jsName,
                    },
                } only %}{% endwidget %}
            {% endblock %}
        {% endif %}


        {% block content %}
            <div class="{{ config.name }}__info">
                {% block name %}
                    {% if data.name and data.url %}
                        {% block link %}
                            {% widget 'ProductUrlWidget' args [
                                data.isAffiliate,
                                data.affiliateData,
                                data.product.attributes ?? [],
                                data.idProductAbstract
                            ] with {
                                data: {
                                    parentJsName: config.jsName,
                                    configName: config.name,
                                    dataName: data.name | replace({'\\': ''}) ,
                                    originUrl: data.url,
                                },
                            } only %}{% endwidget %}
                        {% endblock %}
                    {% endif %}

                    {% if data.name and not data.url %}
                        {% block title %}
                            <span class="{{ config.name }}__name {{ config.jsName }}__name">{{ data.name | replace({'\\': ''}) }}</span>
                        {% endblock %}
                    {% endif %}
                {% endblock %}

                {% block price %}
                    <div class="{{ config.name }}__price">
                        {% if data.isAffiliate %}
                            {% widget 'ProductAffiliateOffersPriceWidget' args [data.idProductAbstract] only %}{% endwidget %}
                        {% elseif can('SeePricePermissionPlugin') %}
                            {% embed molecule('money-price') with {
                                data: {
                                    isAffiliate: data.isAffiliate | default(false),
                                    amount: data.product.prices.DEFAULT | default(null),
                                    originalAmount: data.product.prices.ORIGINAL | default(null),
                                    currencyIsoCode: data.currencyIsoCode,
                                    parentJsName: config.jsName,
                                },
                            } only %}
                                {% block originalPrice %}
                                    {% block originalPriceInner %}
                                        {{ parent() }}
                                    {% endblock %}
                                {% endblock %}
                            {% endembed %}
                        {% else %}
                            {{- 'customer.access.cannot_see_price' | trans -}}
                        {% endif %}
                    </div>
                {% endblock %}
            </div>

            {% block footer %}
                {% if data.isAffiliate | default(false) %}
                    {% widget 'ProductAffiliateOffersWidget' args [data.idProductAbstract] only %}{% endwidget %}
                {% else %}
                    {% set cashback = data.cashback %}

                    {% if cashback %}
                        <div class="{{ config.name }}__footer">
                            {% include molecule('cashback') with {
                                modifiers: ['small'],
                                data: {
                                    cashback: cashback,
                                    shoppingPoints: data.shoppingPoints,
                                    iconModifiers: [''],
                                },
                            } only %}
                        </div>
                    {% endif %}
                {% endif %}

            {% endblock %}
        {% endblock %}
    </div>
{% endblock %}

{% block image %}
    {% set extraClass = '' %}
    {% set modifiers = ['spaceless'] %}

    {% block productThumbnail %}
        {% widget 'ProductUrlWidget' args [
            data.isAffiliate,
            data.affiliateData,
            data.product.attributes ?? [],
            data.idProductAbstract
        ] with {
            data: {
                parentJsName: config.jsName,
                configName: config.name,
                dataName: data.name,
                originUrl: data.url,
                thumbnail: macros.thumbnail(data.image, data.name, extraClass, modifiers, config.jsName),
            },
        } only %}{% endwidget %}
    {% endblock %}
{% endblock %}
